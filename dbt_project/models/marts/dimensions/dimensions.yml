version: 2

models:
  - name: dim_municipio
    description: >
      Conformed municipality dimension containing geographic and administrative
      information for all 5,570+ Brazilian municipalities.
      This is the central dimension linking all fact tables.

      Note: Population and IDHM data can be added when those datasets are extracted.
    config:
      tags: ['dimension', 'municipality', 'gold']

    columns:
      - name: sk_municipio
        description: Surrogate key for the municipality
        tests:
          - unique
          - not_null

      - name: id_municipio_ibge
        description: IBGE 7-digit municipality code (natural key)
        tests:
          - unique
          - not_null

      - name: id_municipio_tse
        description: TSE municipality code for electoral data joins

      - name: nome_municipio
        description: Official municipality name
        tests:
          - not_null

      - name: sigla_uf
        description: State abbreviation (2 letters)
        tests:
          - not_null
          - accepted_values:
              values: ['AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO',
                       'MA', 'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI',
                       'RJ', 'RN', 'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO']

      - name: regiao
        description: Geographic region (Norte, Nordeste, Sudeste, Sul, Centro-Oeste)
        tests:
          - accepted_values:
              values: ['Norte', 'Nordeste', 'Sudeste', 'Sul', 'Centro-Oeste']

      - name: mesorregiao
        description: IBGE mesoregion name

      - name: microrregiao
        description: IBGE microregion name

      - name: is_capital
        description: Flag indicating if municipality is a state capital

      - name: is_amazonia_legal
        description: Flag indicating if municipality is in Legal Amazon

      - name: ddd
        description: Phone area code (useful for regional analysis)

  - name: dim_calendario
    description: >
      Calendar dimension with year-level grain.
      Contains flags for census years, election years, and data availability.

    columns:
      - name: sk_ano
        description: Surrogate key (same as year for simplicity)
        tests:
          - unique
          - not_null

      - name: ano
        description: Calendar year
        tests:
          - unique
          - not_null

      - name: is_ano_censo
        description: Flag indicating IBGE census year (1991, 2000, 2010, 2022)

      - name: is_ano_eleitoral_municipal
        description: Flag indicating municipal election year (every 4 years)

      - name: has_idhm_data
        description: Flag indicating IDHM data availability

  - name: dim_partido
    description: >
      Conformed dimension for Brazilian political parties with ideology classification.
      Based on academic research from Power & Zucco BPCS surveys (2012, 2019),
      Tarouco & Madeira (2013), and Bolognesi, Ribeiro & Codato (2023).

      Grain: One row per political party

      Key Features:
      - Ideology spectrum (5-point categorical)
      - Ideology block (3-point simplified: left/center/right)
      - Numeric ideology score (-2 to +2) for regression analysis
      - Big tent flag for pragmatic/catch-all parties

    config:
      tags: ['dimension', 'political', 'gold']

    columns:
      - name: sk_partido
        description: Surrogate key for the party
        tests:
          - unique
          - not_null

      - name: numero_partido
        description: TSE official party number
        tests:
          - unique
          - not_null

      - name: sigla_partido
        description: Party abbreviation (PT, PSDB, MDB, etc.)
        tests:
          - unique
          - not_null

      - name: nome_partido
        description: Full party name

      - name: espectro_ideologico
        description: 5-point ideology spectrum
        tests:
          - accepted_values:
              values: ['esquerda', 'centro-esquerda', 'centro', 'centro-direita', 'direita']

      - name: bloco_ideologico
        description: Simplified 3-point ideology block
        tests:
          - accepted_values:
              values: ['esquerda', 'centro', 'direita']

      - name: score_ideologico
        description: Numeric ideology score (-2=far left to +2=far right)

      - name: is_big_tent
        description: Flag for pragmatic catch-all parties (MDB, PP, PSD)

      - name: is_ativo
        description: Flag indicating if party is currently active

      - name: era_fundacao
        description: Historical era when party was founded

      - name: intensidade_ideologica
        description: Absolute distance from center (0-2 scale)

      - name: faixa_intensidade_ideologica
        description: Categorical intensity (Forte, Moderado, Fraco/Pragmatico)

  - name: dim_mandato_prefeito
    description: >
      Dimension table tracking mayoral terms (mandates) at municipality level.
      Links municipalities to election results and party ideology over time.

      Grain: One row per municipality per mandate term (4-year periods)

      Key Features:
      - Political continuity tracking (same party reelection)
      - Ideological transition analysis (shift direction and magnitude)
      - Mandate sequence counting
      - Competition level classification

    config:
      tags: ['dimension', 'political', 'gold']

    columns:
      - name: sk_mandato
        description: Surrogate key for the mandate
        tests:
          - unique
          - not_null

      - name: sk_municipio
        description: Foreign key to dim_municipio

      - name: sk_partido
        description: Foreign key to dim_partido (winning party)

      - name: id_municipio
        description: IBGE municipality code
        tests:
          - not_null

      - name: ano_eleicao
        description: Election year (2000, 2004, 2008, 2012, 2016, 2020)
        tests:
          - not_null

      - name: periodo_mandato
        description: Mandate period string (e.g., "2021-2024")

      - name: partido_vencedor
        description: Winning party abbreviation

      - name: percentual_vencedor
        description: Vote share percentage of winning candidate

      - name: nivel_competicao
        description: Electoral competition level
        tests:
          - accepted_values:
              values: ['Sem Competicao', 'Bipolar', 'Moderada', 'Alta']

      - name: espectro_ideologico
        description: Winning party ideology spectrum

      - name: bloco_ideologico
        description: Winning party ideology block (esquerda/centro/direita)

      - name: is_continuidade_partidaria
        description: Flag indicating same party won consecutive mandate

      - name: delta_ideologico
        description: Change in ideology score from previous mandate

      - name: tipo_transicao_ideologica
        description: Categorical description of ideological transition

      - name: direcao_mudanca_ideologica
        description: Direction of ideological shift (esquerda/direita/neutro)
